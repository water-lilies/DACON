# DACON

> 블럭 장난감 제조 공정 최적화 AI경진대회



## 베이스 라인에서 사용한 유전 알고리즘

0. 무작위로 신경망(유전자) 50개 생성

1. 목적함수 결과가 좋은 5개 유전자 선정
2. 5개 중 2개를 무작위로 선택하여 자손 유전자 5개 생성
3. 총 10개의 유전자를 베스트 유전로 선정
4. 10개의 유전자에 돌연변이를 주어 50개의 유전자 생성
5. 1~4 과정 반복



## 유전 알고리즘(Genetic Algorithm)

### 1. 기본 개념

- 자연계의 진화 과정을 모델링한 **최적화** 기법

  (최적화란, 어떠한 제약조건 하에서 우리가 찾고자 하는 정답에 가까운 것을 찾는 과정)

  (최적화를 위한 알고리즘은, 최적화 값을 각 탐색 범위 내에서 조절함으로써 주어진 비용함수 값을 최소화/최대화하는 해를 찾아내는 방법)

- 역전파 없이 학습시킴

- 유전자 알고리즘은 일반적으로 세 종류의 유전자 조작과정을 사용하여 최적해를 탐색한다.

  - 선택 조작(selection)

    최종 목표로 하는 적합함수(fitness)를 최적화시키는 해를 확률적으로 발전시키는 단계. 초기집단으로부터 발전된 집단을 형성시킨다.

    * 적합도(fitness): 어떠한 염색체가 가지고 있는 고유값. 해당 문제에 대해 염색체가 표현하는 해가 얼마나 적합한지 나타낸다.

  - 교차 조작(crossover)

    발전된 집단에 속해있는 배열들 간에 이진수 코드를 교차시키는 역할

  - 돌연변이 조작(mutation)

     각 배열들 자신이 가진 코드를 무작위로 바꿈으로써 자손집단(offspring set)형성. 

    자손집단에 포함된 배열을 적합함수에 적용하여 최적해를 탐색

    - 자손(offspring): 특정 시간에 존재했던 염색체들로부터 생성된 염색체를 말함. 자손은 이전 세대와 비슷한 유전 정보를 갖는다.



### 2. 구조

| 생물학              | 유전알고리즘                   |
| ------------------- | ------------------------------ |
| 염색체(chromosome)  | 문자열(string)                 |
| 유전자(gene)        | 특성(feature)                  |
| 유전자 자리(locus)  | 문자열의 위치(string position) |
| 대립 유전자(allele) | 특성치(feature value)          |

- 염색체 = 유전정보를 담당하는 개체. 염색체들이 모여서 이룬 개체집단을 모집단이라고 함

  유전 알고리즘에서는 하나의 해를 표현한다.

- 유전자 = 염색체 상의 각 인자. 염색체를 구성하는 요소로 하나의 유전 정보를 나타낸다.

  유전자 알고리즘에서 가장 작은 단위.

- 유전자 자리 = 유전자가 존재하는 염색체의 특정 위치

- 대립 유전자 = 유전자 자리에 올 수 있는 유전자 후보



### 3. 연산

(알고리즘 동작)

1. 초기 엄색체의 집합 생성

2. 초기 염색체들에 대한 적합도 계산

3. 현재 염색체들로부터 자손들의 생성

4. 생성된 자손들의 적합도 계산

5. 종료 조건 판별

6. 종료조건이 거짓인 경우, 3. 부터 재실행

   종료조건이 참인 경우, 알고리즘 종료

#### 3.1. 초기 염색체 생성 연산

초기에는 이전 염색체가 존재하지 않기 때문에 선택된 염색체들로부터 자손을 생성할 수가 없다. 따라서, 초기 염색체를 생성하는 연산을 별도로 정의해야 한다. 유전 알고리즘에서 가장 많이 이용되는 방법은 어떠한 규칙도 없이 단순히 임의의 값으로 염색체를 생성하는 것이다. 

```java
Random rand = new Random();
int[] chromosome = new int[SIZE_CHROMOSOME];
 
for(int i = 0; i < SIZE_CHROMOSOME; i++) {
    chromosome[i] = rand.nextInt(MAX_VAL_GENE);
}
```



#### 3.2. 적합도를 계산하는 연산

염색체에 표현된 정보를 기반으로 적합도를 계산하는 연산이다. 

구하고자 하는 문제에 따라 평가함수의 구간값이 다르기 때문에, 구간 사이의 **표준화**된 값을 정해서 새로운 적합도 함수를 구해야 한다.



#### 3.3. 적합도를 기준으로 염색체를 선택하는 연산

자손을 생성하기 위한 두 개의 부모 염색체를 선택할 때는 단순히 적합도가 가장 높은 두 개의 염색체를 선택할 수도 있다. 그러나 이러한 방법은 염색체의 다양성을 크게 훼손시키기 때문에 전역 최적해를 찾기에는 부적합하다. 이러한 문제점을 해결하기 위해 유전 알고리즘에서는 선택 연산 시행

(선택 연산 방법)

* 룰렛 휠 선택

  염색체를 확률식으로 나타내어 룰렛을 만들고, 만들어진 룰렛을 이용하여 염색체 선택.

  룰렛 휠 선택을 이용하면, 적합도가 높은 염색체가 더 높은 확률로 선택되도록 설정하는 동시에 염색체들의 다양성도 유지할 수 있다.

* 기대값 선택

  적합도에 대한 각 객체의 기대값을 구하고, 그 값에 따라 확률적인 재생 개수를 구하여 선택하는 방법. 

  한번 선택된 개체가 반복해서 선택 될 확률을 배제시키기 위해, 선택된 개체수는 기대값을 곱해줘서 다시 뽑힐 확률을 최소화 시킨다.

* 순위기반 선택

  룰렛 휠 선택의 보완(특정 개체들만 선택 될 가능성이 있으므로 이를 보완함). 

  적합도에 따라 순위를 매기고, 그 순위에 따라 확률을 결정한다.

* 토너먼트 선택

  개체군 중 임의의 개체들을 선택하여 비교한 후, 그 중 적합도가 더 높은 개체를 다음 세대에 남기는 방식

* 엘리트 보존 방법

  확률에 따라 개체를 선택하게 될 때, 우수한 개체가 소실되는 것을 막기 위해 가장 좋은 해를 보존하여 다음세대에 넘기는 선택방법. 보통 다른 방법과 함께 사용.



#### 3.4. 선택된 염색체들로부터 자손을 생성하는 연산

 룰렛 휠 선택 방법을 통해 선택된 두개의 부모 염색체들로부터 하나의 자손 염색체를 생성한다. 유전 알고리즘에서는 자손을 생성하는 연산으로 주로 crossover라는 연산을 이용한다. Crossover 연산에서 염색체를 분할하는 지점인 division point는 임의로 선택된다.

(교차 연산 방법)

- 일점 교차

  교차하는 위치를 한군데 결정하고, 그 앞과 뒤에서 어느 쪽의 유전자형을 받을 것인지 결정하여 변경시키는 방법으로 가장 일반적인 교차 방법

- 복수점 교차

  교차위치가 복수인 방식. 예를 들어 교차 위치가 2와 5라면 새로운 개체의 하나는 개체A의 선두로부터 두번째까지, 개체 A의 세번째부터 다섯번째까지, 개체 A의 여섯번째부터 마지막까지 유전자가 만들어진다. 동시에 그 반대의 조합에 의해 또 다른 하나의 새로운 개체의 유전자가 만들어진다.

  P1: a b c d e f g h i j

  P2: k l m n o p q r s t

  S1: a b c n o p q r s t

  S2: k l m d e p q h i j

- 균일교차

  자름선을 이용하지 않고 특정한 마스크를 사용하여 P1과 P2에서 가져오는 유전자를 결정하는 방법

  마스크 값이 0일 경우, P1에서 값을 가져오고

  마스크 값이 1일 경우, P2에서 값을 가져오는 방법으로 유전자를 교차시킨다.

  일점교차나 복수점교차에 비해 스키마의 결합 형태가 다양하고 수렴 시간이 오래걸린다.

  

#### 3.5. 돌연변이 연산

앞의 연산들로 유전 알고리즘은 지역 최적점(local minimum)에 도달했을 것. 유전 알고리즘에서는 지역 최적점에 빠지는 문제를 해결하기 위해 새롭게 생성된 염색체에 확률적으로 돌연변이가 발생하도록 한다. 즉, 개체군의 다양성을 유지하여 지역최적점에 빠질 위험을 배제한다.

일반적으로 0.1%, 0.05% 등의 아주 낮은 확률로 돌연변이가 발생하도록 설정한다.

a) reverse : 임의로 하나의 유전자를 선택하여 0->1, 1->0으로 바꿈

b) exchange: 임의로 두개의 유전자를 선택하여 두 유전자의 값을 교환.

초기에는 품질이 좋지 않은 해가 많으므로 강도를 높이는 게 좋지만, 후반에는 품질 향상에 변이가 큰 영향을 미치지 않으므로 강도를 낮춰준다. 

